extends base_dashboard
block content 
    section.content-header 
        h1 
            | Dashboard
            
        ol.breadcrumb 
            li 
                a(href='#') 
                    i.fa.fa-dashboard
                    | Dashboard 
            
    section.content
        div.row
          <div id="alert"> </div>
          - if(data !== 'undefined'){var dd = JSON.parse(data);}
          input(type="text", value="#{data}",id="data",hidden="true")
          input(type="text", value="#{JSON.stringify(graph_data)}",id="graph_data",hidden="true")
          script(type='text/javascript',src='/socket.io/socket.io.js')
          script(type='text/javascript').
                console.log("from pageeee");
                var socket = io();
                 io.on('unauthorized', function(rows) {
                   //if(rows[i].assets_last_location === "reader_1"){
                   console.log("rows from page:"+rows);
                   var html='';

                     html += '<div class="alert alert-danger alert-dismissible">'+
                                 '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+
                                    '<h4><i class="icon fa fa-ban"></i> Alert!</h4>'+rows+
                                 '</div>';
                   }  
                   document.getElementById("alert").innerHTML = html;
                   console.log(rows);
                   // }
                 });
        div.row
            div.col-lg-3.col-xs-6
                //div.small-box(style="background:#3c8dbc;color:white")
                div.small-box.bg-aqua-active
                    div.inner
                       if assets_volume === undefined
                        h3 0
                        p Available Assets
                       else
                        h3 #{assets_volume}
                        p Available Assets
                    div.icon
                        i.fa.fa-archive
                    a(href="/admin_assets").small-box-footer
                        | More info
                        i.fa.fa-arrow-circle-right
            
            div.col-lg-3.col-xs-6
                //div.small-box(style="background:#3c8dbc;color:white")
                div.small-box.bg-aqua 
                    div.inner
                       if active_gateway === undefined
                        h3 0
                        p Device Manager
                       else
                        h3 #{active_gateway}
                        p Device Manager
                    div.icon
                        i.fa.fa-wifi
                    a(href="/admin_gateway").small-box-footer
                        | More info
                        i.fa.fa-arrow-circle-right
                        
            div.col-lg-3.col-xs-6
                //div.small-box(style="background:#3c8dbc;color:white")
                div.small-box.bg-aqua-active
                    div.inner
                       if maintenance === undefined
                        h3 0
                        p Due for maintenance
                       else
                        h3 #{maintenance}
                        p Due for maintenance
                    div.icon
                        i.fa.fa-wrench
                    a(href="/maintenance_assets").small-box-footer
                        | More info
                        i.fa.fa-arrow-circle-right
                        
            div.col-lg-3.col-xs-6
                //div.small-box.bg-aqua
                div.small-box.bg-red 
                    div.inner
                       if monitoring === undefined
                        h3 0
                        p Unauthorized Movements
                       else
                        h3 #{monitoring}
                        p Unauthorized Movements
                    div.icon
                        i.fa.fa-warning
                    a(href="/admin_unauthorized").small-box-footer
                        | More info
                        i.fa.fa-arrow-circle-right
                        

        section.content
            div.row
                div.col-md-12
                  div.box.box-primary
                    div.box-header.with-border
                      h3.box-title
                       | Search Assets
                       if(message)
                        | #{message}
                    div.box-body
                      form.form-horizontal(method='post',action='/')
                       div.form-group
                          label(for="rfid",class="col-sm-2 control-label") Search for:
                          div.input-group.input-group-sm.col-sm-6
                            input.input-group.input-group-sm(type="text",class="form-control",id="search_query",name="search_query",placeholder="Asset / Location")
                            span.input-group-btn
                               button(type="submit",class="btn btn-primary",id="save_btn") Search
                               
                       div(id="image-map-dashboard")
                       script(type='text/javascript', src='https://unpkg.com/leaflet@1.0.2/dist/leaflet.js')
                       script(type='text/javascript').
                          Array.prototype.contains = function(v) {
                                for(var i = 0; i < this.length; i++) {
                                    if(this[i] === v) return true;
                                }
                                return false;
                            };

                            Array.prototype.unique = function() {
                                var arr = [];
                                for(var i = 0; i < this.length; i++) {
                                    if(!arr.contains(this[i])) {
                                        arr.push(this[i]);
                                    }
                                }
                                return arr; 
                            };
                            
                       script(type='text/javascript').
                            var data = document.getElementById("data").value;
                            if(data!=='undefined'){
                            var dd = JSON.parse(data);
                            
                            alert(dd.length+" record(s) found");
                            }
                            if(data === ''){
                                alert("No record found");
                            }

                            //source => http://codepen.io/zachdunn/pen/VvRXdP
                                // Using leaflet.js to pan and zoom a big image.
                            // See also: http://kempe.net/blog/2014/06/14/leaflet-pan-zoom-image.html
                            // Marker Pin: http://codepen.io/zachdunn/pen/wapEam
                            // create the slippy map
                            //var map = L.map('image-map-dashboard', {
                             // minZoom: 1,
                             // maxZoom: 4,
                             // center: [0, 0],
                              //zoom: 1,
                              //crs: L.CRS.Simple,
                              //attributionControl: false
                            //});
                            
                            var map = L.map('image-map-dashboard', {
                              minZoom: 1,
                              maxZoom: 4,
                              zoom: 1,
                              center: [0, 0],
                              crs: L.CRS.Simple,
                              attributionControl: false
                            });
                            
                            
                            L.control.attribution({
                              prefix: false
                            }).addAttribution('').addTo(map);
                            // House: http://i.imgur.com/cenqiCf.jpg
                            // Palace SVG (1280 x 806): https://dl.dropbox.com/s/yhrpnftsuis15z6/Topkapi_Palace_plan.svg
                            // dimensions of the image
                            var w = 1400 * 2,
                            h = 1600 * 2,
                            //url = '/adminlte/dist/img/hospital_floor_plan.jpg';
                            url = '/uploads/map/icu_smc3.png';

                            // calculate the edges of the image, in coordinate space
                            var southWest = map.unproject([0, h], map.getMaxZoom() - 1);
                            var northEast = map.unproject([w, 0], map.getMaxZoom() - 1);
                            var bounds = new L.LatLngBounds(southWest, northEast);

                            // add the image overlay, 
                            // so that it covers the entire map
                            L.imageOverlay(url, bounds).addTo(map);

                            // tell leaflet that the map is exactly as big as the image
                            map.setMaxBounds(bounds);
                            map.touchZoom.disable();
                            map.doubleClickZoom.disable();
                            map.scrollWheelZoom.disable();
                            map.dragging.disable();
                            map.boxZoom.disable();
                            map.keyboard.disable();
                            map.removeControl(map.zoomControl);
                            map.zoomControl.remove();

                            // pixel coords
                            var m = {
                                x: 1200,
                                y: 3800
                              };

                              var n = {
                                x: 2500,
                                y: 4500
                              };
                              
                              var k = {
                                x: 1000,
                                y: 4700
                              };

                              //Add marker

                            //map.on('click', addMarker);
                            var addedOne = false,
                              checkpoint1 = L.divIcon({
                                className: 'checkpoint-pin',
                                html: '<img src="/adminlte/dist/img/wifi_3.png" data-toggle="modal" data-target="#myModal">',
                                iconSize: [20, 20],
                                iconAnchor: [18, 30]
                              });
                              
                              var addedOne = false,
                              checkpoint1_1 = L.divIcon({
                                className: 'checkpoint-pin',
                                html: '<img src="/adminlte/dist/img/wifi_3.png" data-toggle="modal" data-target="#result1">',
                                iconSize: [20, 20],
                                iconAnchor: [18, 30]
                              });


                              var table = false,
                              checkpoint2 = L.divIcon({
                                className: 'checkpoint-pin',
                                html: '<img src="/adminlte/dist/img/wifi_3.png" data-toggle="modal" data-target="#myModal2">',
                                iconSize: [20, 20],
                                iconAnchor: [18, 30]
                              });
                              
                              var table = false,
                              checkpoint2_1 = L.divIcon({
                                className: 'checkpoint-pin',
                                html: '<img src="/adminlte/dist/img/wifi_3.png" data-toggle="modal" data-target="#result2">',
                                iconSize: [20, 20],
                                iconAnchor: [18, 30]
                              });
                              
                              var table = false,
                              checkpoint3 = L.divIcon({
                                className: 'checkpoint-pin',
                                html: '<img src="/adminlte/dist/img/wifi_3.png" data-toggle="modal" data-target="#myModal3">',
                                iconSize: [20, 20],
                                iconAnchor: [18, 30]
                              });
                              
                              var table = false,
                              checkpoint3_1 = L.divIcon({
                                className: 'checkpoint-pin',
                                html: '<img src="/adminlte/dist/img/wifi_3.png" data-toggle="modal" data-target="#result3">',
                                iconSize: [20, 20],
                                iconAnchor: [18, 30]
                              });


                            // Lookup neighbors https://github.com/mapbox/leaflet-knn
                            
                            if(data === 'undefined'){
                                var chekpointMark = L.marker(map.unproject([m.x, m.y], map.getMaxZoom()), {
                                  icon: checkpoint1
                                }).addTo(map);
                                
                                var chekpointMark2 = L.marker(map.unproject([n.x, n.y], map.getMaxZoom()), {
                                  icon: checkpoint2
                                }).addTo(map);
                                
                                var chekpointMark3 = L.marker(map.unproject([k.x, k.y], map.getMaxZoom()), {
                                  icon: checkpoint3
                                }).addTo(map);
                            }
                            else{
                            //alert("here 1");    
                            var locations = [];
                            for (var i=0; i<dd.length; i++) {
                                locations.push(dd[i].assets_last_location);
                            }
                            //alert("here 2");
                            var uniques = locations.unique();
                            //alert("locations ="+locations);
                            //alert("uniques ="+uniques);
                            
                            for (var i=0; i<uniques.length; i++) {
                                if(uniques[i] === "2"){
                                var chekpointMark = L.marker(map.unproject([m.x, m.y], map.getMaxZoom()), {
                                  icon: checkpoint1_1
                                }).addTo(map);
                                }
                                
                                if(uniques[i] === "12"){
                                 var chekpointMark2 = L.marker(map.unproject([n.x, n.y], map.getMaxZoom()), {
                                  icon: checkpoint2_1
                                }).addTo(map);
                               }
                               
                               if(uniques[i] === "32"){
                                   var chekpointMark3 = L.marker(map.unproject([k.x, k.y], map.getMaxZoom()), {
                                  icon: checkpoint3_1
                                }).addTo(map);
                               }
                            }
                            }
                
            div.row
                div.col-md-8
                  div.box.box-primary
                    div.box-header.with-border
                      h3.box-title
                       | Assets Movements
                    div.box-body
                      div.chart
                        canvas(id="areaChart",style="height:250px")
                div.col-md-4
                  div.box.box-primary
                     div.box-header.with-border
                       h3.box-title Unauthorized Movements
                     div.box-body
                       ul.products-list.product-list-in-box
                         for row, index in movements
                            li.item
                              div.product-img
                               if row.assets_img_path !== null
                                  img(src='#{row.assets_img_path}',alt="Product Image")
                               else
                                  img(src='uploads/no_image.jpg',alt="Product Image")
                                //img(src="#{row.assets_img_path}",alt="Product Image")
                              div.product-info
                                a.product-title() #{row.assets_item_desc+" ("+row.assets_rfid+")"}
                                  span.product-description #{row.new_date}
                                  span.product-description #{row.zone_name}
                           
                      div.box-footer.text-center
                        a.uppercase(href="/admin_unauthorized") View All Movements
                        
        div.modal.fade(id="myModal",tabindex="-1",role="dialog",aria-labelledby="myModalLabel")
           div.modal-dialog(role="document")
              div.modal-content
                 div.modal-header
                    button(type="button",class="close",data-dismiss="modal",aria-label="Close")
                    span(aria-hidden="true")
                    h4.modal-title(id="myModalLabel")
                     | ICU
                 div.modal-body
                       ul.products-list.product-list-in-box
                        <div id="display"> </div>
                        script(type='text/javascript',src='/socket.io/socket.io.js')
                        script(type='text/javascript').
                            //console.log("from pageeee");
                            var socket = io();
                             socket.on('showrows', function(rows) {
                               //if(rows[i].assets_last_location === "reader_1"){
                               //console.log("rows from page:"+rows.length);
                               var html='';
                               for (var i=0; i<rows.length; i++) {
                                 var img = rows[i].assets_img_path;
                                 if(rows[i].assets_img_path === "" || rows[i].assets_img_path === null){
                                     img = "uploads/no_image.jpg";
                                 }
                                 var d = new Date(rows[i].assets_last_datetime);
                                 d.setMinutes(d.getMinutes()+d.getTimezoneOffset());
                                 var ddate = d.getDate();
                                 var dmonth = d.getMonth()+1;
                                 var dyear = d.getFullYear();
                                 var dhour = d.getHours();
                                 var dminutes = d.getMinutes();
                                 var dseconds = d.getSeconds();
                                 
                                 if(ddate < 10){
                                     ddate = "0"+ddate;
                                 }
                                 if(dmonth < 10){
                                     dmonth = "0"+dmonth;
                                 }
                                 
                                 if(dhour < 10){
                                     dhour = "0"+dhour;
                                 }
                                 if(dminutes < 10){
                                     dminutes = "0"+dminutes;
                                 }
                                 if(dseconds < 10){
                                     dseconds = "0"+dseconds;
                                 }
                                 
                                 
                                 var newdate;
                                    if(dhour < 12){
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" AM";
                                    }
                                    else{
                                        dhour = dhour-12;
                                        if(dhour < 10){
                                            dhour = "0"+dhour;
                                            }
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" PM";
                                    }
                                 html += '<li class="item">'+
                                             '<div class="product-img">'+
                                                '<img src="'+img+'" alt="Asset Image"/></div>'+
                                             '<div class="product-info">'+
                                                '<a href="#" class="product-title">'+rows[i].assets_item_desc+ ' ('+rows[i].assets_rfid+')<span class="product-description">'+newdate+'</span></a></div>'+
                                         '</li><br>';
                               }  
                               document.getElementById("display").innerHTML = html;
                               console.log(rows);
                               // }
                             });
                          
                 div.modal-footer
                   button(type="button",class="btn btn-default",data-dismiss="modal")
                     | Close
                     
    div.modal.fade(id="myModal2",tabindex="-1",role="dialog",aria-labelledby="myModalLabel")
           div.modal-dialog(role="document")
              div.modal-content
                 div.modal-header
                    button(type="button",class="close",data-dismiss="modal",aria-label="Close")
                    span(aria-hidden="true")
                    h4.modal-title(id="myModalLabel")
                     | CCU
                 div.modal-body
                       ul.products-list.product-list-in-box
                        <div id="display2"> </div>
                        script(type='text/javascript',src='/socket.io/socket.io.js')
                        script(type='text/javascript').
                            //console.log("from pageeee22");
                            var socket = io();
                             socket.on('showrows2', function(rows) {
                                //console.log("rows from page2:"+rows.length);
                               //if(rows[i].assets_last_location === "reader_2"){
                               var html='';
                               for (var i=0; i<rows.length; i++) {
                                 var img = rows[i].assets_img_path;
                                 if(rows[i].assets_img_path === "" || rows[i].assets_img_path === null){
                                     img = "uploads/no_image.jpg";
                                 }
                                 var d = new Date(rows[i].assets_last_datetime);
                                 d.setMinutes(d.getMinutes()+d.getTimezoneOffset());
                                 var ddate = d.getDate();
                                 var dmonth = d.getMonth()+1;
                                 var dyear = d.getFullYear();
                                 var dhour = d.getHours();
                                 var dminutes = d.getMinutes();
                                 var dseconds = d.getSeconds();
                                 
                                 if(ddate < 10){
                                     ddate = "0"+ddate;
                                 }
                                 if(dmonth < 10){
                                     dmonth = "0"+dmonth;
                                 }
                                 
                                 if(dhour < 10){
                                     dhour = "0"+dhour;
                                 }
                                 if(dminutes < 10){
                                     dminutes = "0"+dminutes;
                                 }
                                 if(dseconds < 10){
                                     dseconds = "0"+dseconds;
                                 }
                                 
                                 
                                 var newdate;
                                    if(dhour < 12){
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" AM";
                                    }
                                    else{
                                        dhour = dhour-12;
                                        if(dhour < 10){
                                            dhour = "0"+dhour;
                                            }
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" PM";
                                    }
                                 html += '<li class="item">'+
                                             '<div class="product-img">'+
                                                '<img src="'+img+'" alt="Asset Image"/></div>'+
                                             '<div class="product-info">'+
                                                '<a href="#" class="product-title">'+rows[i].assets_item_desc+ ' ('+rows[i].assets_rfid+')<span class="product-description">'+newdate+'</span></a></div>'+
                                         '</li><br>';
                               }  
                               document.getElementById("display2").innerHTML = html;
                               //console.log(rows);
                                //}
                             });
                          
                 div.modal-footer
                   button(type="button",class="btn btn-default",data-dismiss="modal")
                     | Close
                     
    div.modal.fade(id="myModal3",tabindex="-1",role="dialog",aria-labelledby="myModalLabel")
           div.modal-dialog(role="document")
              div.modal-content
                 div.modal-header
                    button(type="button",class="close",data-dismiss="modal",aria-label="Close")
                    span(aria-hidden="true")
                    h4.modal-title(id="myModalLabel")
                     | HDU
                 div.modal-body
                       ul.products-list.product-list-in-box
                        <div id="display3"> </div>
                        script(type='text/javascript',src='/socket.io/socket.io.js')
                        script(type='text/javascript').
                            //console.log("from pageeee22");
                            var socket = io();
                             socket.on('showrows3', function(rows) {
                                //console.log("rows from page2:"+rows.length);
                               //if(rows[i].assets_last_location === "reader_2"){
                               var html='';
                               for (var i=0; i<rows.length; i++) {
                                 var img = rows[i].assets_img_path;
                                 if(rows[i].assets_img_path === "" || rows[i].assets_img_path === null){
                                     img = "uploads/no_image.jpg";
                                 }
                                 var d = new Date(rows[i].assets_last_datetime);
                                 d.setMinutes(d.getMinutes()+d.getTimezoneOffset());
                                 var ddate = d.getDate();
                                 var dmonth = d.getMonth()+1;
                                 var dyear = d.getFullYear();
                                 var dhour = d.getHours();
                                 var dminutes = d.getMinutes();
                                 var dseconds = d.getSeconds();
                                 
                                 if(ddate < 10){
                                     ddate = "0"+ddate;
                                 }
                                 if(dmonth < 10){
                                     dmonth = "0"+dmonth;
                                 }
                                 
                                 if(dhour < 10){
                                     dhour = "0"+dhour;
                                 }
                                 if(dminutes < 10){
                                     dminutes = "0"+dminutes;
                                 }
                                 if(dseconds < 10){
                                     dseconds = "0"+dseconds;
                                 }
                                 
                                 
                                 var newdate;
                                    if(dhour < 12){
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" AM";
                                    }
                                    else{
                                        dhour = dhour-12;
                                        if(dhour < 10){
                                            dhour = "0"+dhour;
                                            }
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" PM";
                                    }
                                 html += '<li class="item">'+
                                             '<div class="product-img">'+
                                                '<img src="'+img+'" alt="Asset Image"/></div>'+
                                             '<div class="product-info">'+
                                                '<a href="#" class="product-title">'+rows[i].assets_item_desc+ ' ('+rows[i].assets_rfid+')<span class="product-description">'+newdate+'</span></a></div>'+
                                         '</li><br>';
                               }  
                               document.getElementById("display3").innerHTML = html;
                               //console.log(rows);
                                //}
                             });
                          
                 div.modal-footer
                   button(type="button",class="btn btn-default",data-dismiss="modal")
                     | Close
                     
    div.modal.fade(id="result1",tabindex="-1",role="dialog",aria-labelledby="myModalLabel")
           div.modal-dialog(role="document")
              div.modal-content
                 div.modal-header
                    button(type="button",class="close",data-dismiss="modal",aria-label="Close")
                    span(aria-hidden="true")
                    h4.modal-title(id="myModalLabel")
                     | ICU
                 div.modal-body
                       ul.products-list.product-list-in-box
                        <div id="display4"> </div>
                        script(type='text/javascript').
                            var data = document.getElementById("data").value;
                            if(data!=='undefined'){
                            var dd = JSON.parse(data);
                            //alert("data in js="+JSON.stringify(dd[0].assets_id));
                            }
                            //console.log("from pageeee");
                            //var socket = io();
                             //socket.on('showrows', function(rows) {
                               //if(rows[i].assets_last_location === "reader_1"){
                               //console.log("rows from page:"+rows.length);
                               
                            var html='';
                            for (var i=0; i<dd.length; i++) {
                              if(dd[i].assets_last_location === "2"){
                              var img = dd[i].assets_img_path;
                              if(dd[i].assets_img_path === "" || dd[i].assets_img_path === null){
                                  img = "uploads/no_image.jpg";
                              }
                              var d = new Date(dd[i].assets_last_datetime);
                              d.setMinutes(d.getMinutes()+d.getTimezoneOffset());
                              var ddate = d.getDate();
                              var dmonth = d.getMonth()+1;
                              var dyear = d.getFullYear();
                              var dhour = d.getHours();
                              var dminutes = d.getMinutes();
                              var dseconds = d.getSeconds();

                              if(ddate < 10){
                                  ddate = "0"+ddate;
                              }
                              if(dmonth < 10){
                                  dmonth = "0"+dmonth;
                              }

                              if(dhour < 10){
                                  dhour = "0"+dhour;
                              }
                              if(dminutes < 10){
                                  dminutes = "0"+dminutes;
                              }
                              if(dseconds < 10){
                                  dseconds = "0"+dseconds;
                              }


                              var newdate;
                                    if(dhour < 12){
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" AM";
                                    }
                                    else{
                                        dhour = dhour-12;
                                        if(dhour < 10){
                                            dhour = "0"+dhour;
                                            }
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" PM";
                                    }
                              html += '<li class="item">'+
                                          '<div class="product-img">'+
                                             '<img src="'+img+'" alt="Asset Image"/></div>'+
                                          '<div class="product-info">'+
                                             '<a href="#" class="product-title">'+dd[i].assets_item_desc+ ' ('+dd[i].assets_rfid+')<span class="product-description">'+newdate+'</span></a></div>'+
                                      '</li><br>';
                            }
                            }
                            document.getElementById("display4").innerHTML = html;
                            console.log(rows);
                               // }
                             //});
                          
                 div.modal-footer
                   button(type="button",class="btn btn-default",data-dismiss="modal")
                     | Close
                  
    div.modal.fade(id="result2",tabindex="-1",role="dialog",aria-labelledby="myModalLabel")
           div.modal-dialog(role="document")
              div.modal-content
                 div.modal-header
                    button(type="button",class="close",data-dismiss="modal",aria-label="Close")
                    span(aria-hidden="true")
                    h4.modal-title(id="myModalLabel")
                     | CCU
                 div.modal-body
                       ul.products-list.product-list-in-box
                        <div id="display5"> </div>
                        script(type='text/javascript').
                            var data = document.getElementById("data").value;
                            if(data!=='undefined'){
                            var dd = JSON.parse(data);
                            //alert("data in js="+JSON.stringify(dd[0].assets_id));
                            }
                            //console.log("from pageeee");
                            //var socket = io();
                             //socket.on('showrows', function(rows) {
                               //if(rows[i].assets_last_location === "reader_1"){
                               //console.log("rows from page:"+rows.length);
                               
                            var html='';
                            for (var i=0; i<dd.length; i++) {
                              if(dd[i].assets_last_location === "12"){
                              var img = dd[i].assets_img_path;
                              if(dd[i].assets_img_path === "" || dd[i].assets_img_path === null){
                                  img = "uploads/no_image.jpg";
                              }
                              var d = new Date(dd[i].assets_last_datetime);
                              d.setMinutes(d.getMinutes()+d.getTimezoneOffset());
                              var ddate = d.getDate();
                              var dmonth = d.getMonth()+1;
                              var dyear = d.getFullYear();
                              var dhour = d.getHours();
                              var dminutes = d.getMinutes();
                              var dseconds = d.getSeconds();

                              if(ddate < 10){
                                  ddate = "0"+ddate;
                              }
                              if(dmonth < 10){
                                  dmonth = "0"+dmonth;
                              }

                              if(dhour < 10){
                                  dhour = "0"+dhour;
                              }
                              if(dminutes < 10){
                                  dminutes = "0"+dminutes;
                              }
                              if(dseconds < 10){
                                  dseconds = "0"+dseconds;
                              }


                              var newdate;
                                    if(dhour < 12){
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" AM";
                                    }
                                    else{
                                        dhour = dhour-12;
                                        if(dhour < 10){
                                            dhour = "0"+dhour;
                                            }
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" PM";
                                    }
                              html += '<li class="item">'+
                                          '<div class="product-img">'+
                                             '<img src="'+img+'" alt="Asset Image"/></div>'+
                                          '<div class="product-info">'+
                                             '<a href="#" class="product-title">'+dd[i].assets_item_desc+ ' ('+dd[i].assets_rfid+')<span class="product-description">'+newdate+'</span></a></div>'+
                                      '</li><br>';
                            }
                            }
                            document.getElementById("display5").innerHTML = html;
                            console.log(rows);
                               // }
                             //});
                          
                 div.modal-footer
                   button(type="button",class="btn btn-default",data-dismiss="modal")
                     | Close
                     
    div.modal.fade(id="result3",tabindex="-1",role="dialog",aria-labelledby="myModalLabel")
           div.modal-dialog(role="document")
              div.modal-content
                 div.modal-header
                    button(type="button",class="close",data-dismiss="modal",aria-label="Close")
                    span(aria-hidden="true")
                    h4.modal-title(id="myModalLabel")
                     | HDU
                 div.modal-body
                       ul.products-list.product-list-in-box
                        <div id="display6"> </div>
                        script(type='text/javascript').
                            var data = document.getElementById("data").value;
                            if(data!=='undefined'){
                            var dd = JSON.parse(data);
                            //alert("data in js="+JSON.stringify(dd[0].assets_id));
                            }
                            //console.log("from pageeee");
                            //var socket = io();
                             //socket.on('showrows', function(rows) {
                               //if(rows[i].assets_last_location === "reader_1"){
                               //console.log("rows from page:"+rows.length);
                               
                            var html='';
                            for (var i=0; i<dd.length; i++) {
                              if(dd[i].assets_last_location === "32"){
                              var img = dd[i].assets_img_path;
                              if(dd[i].assets_img_path === "" || dd[i].assets_img_path === null){
                                  img = "uploads/no_image.jpg";
                              }
                              var d = new Date(dd[i].assets_last_datetime);
                              d.setMinutes(d.getMinutes()+d.getTimezoneOffset());
                              var ddate = d.getDate();
                              var dmonth = d.getMonth()+1;
                              var dyear = d.getFullYear();
                              var dhour = d.getHours();
                              var dminutes = d.getMinutes();
                              var dseconds = d.getSeconds();

                              if(ddate < 10){
                                  ddate = "0"+ddate;
                              }
                              if(dmonth < 10){
                                  dmonth = "0"+dmonth;
                              }

                              if(dhour < 10){
                                  dhour = "0"+dhour;
                              }
                              if(dminutes < 10){
                                  dminutes = "0"+dminutes;
                              }
                              if(dseconds < 10){
                                  dseconds = "0"+dseconds;
                              }


                              var newdate;
                                    if(dhour < 12){
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" AM";
                                    }
                                    else{
                                        dhour = dhour-12;
                                        if(dhour < 10){
                                            dhour = "0"+dhour;
                                            }
                                        newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" PM";
                                    }
                              html += '<li class="item">'+
                                          '<div class="product-img">'+
                                             '<img src="'+img+'" alt="Asset Image"/></div>'+
                                          '<div class="product-info">'+
                                             '<a href="#" class="product-title">'+dd[i].assets_item_desc+ ' ('+dd[i].assets_rfid+')<span class="product-description">'+newdate+'</span></a></div>'+
                                      '</li><br>';
                            }
                            }
                            document.getElementById("display6").innerHTML = html;
                            console.log(rows);
                               // }
                             //});
                          
                 div.modal-footer
                   button(type="button",class="btn btn-default",data-dismiss="modal")
                     | Close
                     

script.
        //alert("intooo");
        function createDateAsUTC(date) {
            return new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds()));
        }
        //alert("intooo2");
        function changeDateFormat(dates){
        
        var d = createDateAsUTC(new Date(dates));

        d.setMinutes(d.getMinutes()+480);
        var ddate = d.getDate();
        var dmonth = d.getMonth()+1;
        var dyear = d.getFullYear();
        var dhour = d.getHours();
        var dminutes = d.getMinutes();
        var dseconds = d.getSeconds();

        if(ddate < 10){
            ddate = "0"+ddate;
        }
        if(dmonth < 10){
            dmonth = "0"+dmonth;
        }

        if(dhour < 10){
            dhour = "0"+dhour;
        }
        if(dminutes < 10){
            dminutes = "0"+dminutes;
        }
        if(dseconds < 10){
            dseconds = "0"+dseconds;
        }

        if(dhour < 12){
            newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" AM";
        }
        else{
            newdate = ddate+"-"+dmonth+"-"+dyear+" "+dhour+":"+dminutes+":"+dseconds+" PM";
        }
        return newdate;
        }
        
   
     
